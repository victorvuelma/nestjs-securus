# Migration `20200904011119-create-vehicle-structure`

This migration has been generated by Victor Vuelma at 9/3/2020, 10:11:19 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."DocumentType" AS ENUM ('RG', 'CNH')

CREATE TABLE "public"."CustomerDocuments" (
"id" SERIAL,
"type" "DocumentType"  NOT NULL ,
"value" text   NOT NULL ,
"customerId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VechicleManufacturer" (
"id" SERIAL,
"name" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VehicleModel" (
"id" SERIAL,
"name" text   NOT NULL ,
"year" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"manufacturerId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VehicleVariation" (
"id" SERIAL,
"name" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   ,
"modelId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "CustomerDocuments.type_customerId_unique" ON "public"."CustomerDocuments"("type", "customerId")

CREATE UNIQUE INDEX "VehicleModel.name_year_unique" ON "public"."VehicleModel"("name", "year")

ALTER TABLE "public"."CustomerDocuments" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."VehicleModel" ADD FOREIGN KEY ("manufacturerId")REFERENCES "public"."VechicleManufacturer"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."VehicleVariation" ADD FOREIGN KEY ("modelId")REFERENCES "public"."VehicleModel"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER INDEX "public"."Customer.cpf" RENAME TO "Customer.cpf_unique"

ALTER INDEX "public"."Customer.email" RENAME TO "Customer.email_unique"

ALTER INDEX "public"."User.cpf" RENAME TO "User.cpf_unique"

ALTER INDEX "public"."User.email" RENAME TO "User.email_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200904010322-create-customer-documents-table..20200904011119-create-vehicle-structure
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -18,38 +18,68 @@
   CNH
 }
 model Customer {
-  id                 Int       @default(autoincrement()) @id
-  cpf                String    @unique
-  email              String    @unique
-  password           String
-  name               String
-  lastname           String?
-  birthDate          DateTime
-  gender             Gender    @default(OTHER)
-  phone              String?
-  cellPhone          String?
-  createdAt          DateTime  @default(now())
-  updatedAt          DateTime? @updatedAt
+  id                 Int                  @default(autoincrement()) @id
+  cpf                String               @unique
+  email              String               @unique
+  password           String           
+  name               String           
+  lastname           String?           
+  birthDate          DateTime           
+  gender             Gender               @default(OTHER)
+  phone              String?           
+  cellPhone          String?           
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
   documents          CustomerDocuments[]
 }
 model CustomerDocuments {
-  id                 Int       @default(autoincrement()) @id
+  id                 Int                  @default(autoincrement()) @id
   type               DocumentType
   value              String
-  customer           Customer  @relation(fields: [customerId], references: [id])
+  customer           Customer             @relation(fields: [customerId], references: [id])
   customerId         Int
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
   @@unique([type, customerId])
 }
+model VechicleManufacturer {
+  id                 Int                  @default(autoincrement()) @id
+  name               String
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
+}
+
+model VehicleModel {
+  id                 Int                  @default(autoincrement()) @id
+  name               String
+  year               Int
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
+  manufacturer       VechicleManufacturer @relation(fields: [manufacturerId], references: [id])
+  manufacturerId     Int
+
+  @@unique([name, year])
+}
+
+model VehicleVariation {
+  id                 Int                  @default(autoincrement()) @id
+  name               String
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
+  model              VehicleModel         @relation(fields: [modelId], references: [id])
+  modelId            Int
+}
+
 model User {
-  id                 Int       @default(autoincrement()) @id
-  cpf                String    @unique
-  email              String    @unique
-  password           String
-  fullName           String
-  createdAt          DateTime  @default(now())
-  updatedAt          DateTime? @updatedAt
+  id                 Int                  @default(autoincrement()) @id
+  cpf                String               @unique
+  email              String               @unique
+  password           String           
+  fullName           String           
+  createdAt          DateTime             @default(now())
+  updatedAt          DateTime?            @updatedAt
 }
```


